{"id":"voelgoedevents-1fu","title":"OrganizationSettings missing primary read action breaks Organization.settings relationship load","description":"Full accounts test run fails with:\n\n- `RuntimeError: Required primary read action for Voelgoedevents.Ash.Resources.Organizations.OrganizationSettings`\n\nRepro:\n- `mix test test/voelgoedevents/ash/accounts_test.exs`\n\nWhere:\n- Tests do `Ash.load!(organization, :settings, actor: actor)` and Ash cannot find a primary read action for OrganizationSettings.\n\nFix direction:\n- In `lib/voelgoedevents/ash/resources/organizations/organization_settings.ex`, mark an existing `read` action as `primary? true` (or add one if absent), without changing policies.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T18:40:13.015128405+02:00","updated_at":"2025-12-17T19:07:50.029320862+02:00","closed_at":"2025-12-17T19:07:50.029340515+02:00","dependencies":[{"issue_id":"voelgoedevents-1fu","depends_on_id":"voelgoedevents-050","type":"discovered-from","created_at":"2025-12-17T18:41:03.554085085+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-o76","title":"User resource RBAC/tenancy drift vs Phase 2 docs","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents/ash/resources/accounts/user.ex allows anonymous :read and allows any org member to :create/:update users without owner/admin gating; also actor fields use :id instead of canonical :user_id and policy expr uses ^actor(...) patterns. Align with /docs/phases_and_roadmap/PHASE_02_Tenancy_Accounts_\u0026_RBAC.md and /docs/domain/rbac_and_platform_access.md.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:56:35.188856598+02:00","updated_at":"2025-12-17T08:56:35.188856598+02:00","dependencies":[{"issue_id":"voelgoedevents-o76","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:56:47.366668967+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-u2l","title":"AuditChange: fix context access (no map/Access on Ash.Resource.Change.Context)","description":"Progress (2025-12-16):\n- Added actor_id normalization (binary/int/map-\u003eid) and string coercion.\n- Made actor extraction KeyError-safe (no dot-access).\n- Added accepted-input filtering when calling Ash.create/3 for audit log resources, removing \"No such input ...\" errors.\n\nCurrent status:\n- Tests still fail: \"attribute actor_id is required\" when creating SuccessAuditLog.\n- Strong suspicion: after_changeset.context may be a KEYWORD LIST (not a map), so Map.get(ctx, :actor) returns nil and actor_id stays nil.\n\nNext:\n- Update actor extraction to support map OR keyword contexts (Map.get vs Keyword.get).\n- Also check :private contexts for actor.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-16T19:29:39.535603949+02:00","updated_at":"2025-12-16T20:21:04.55363987+02:00","dependencies":[{"issue_id":"voelgoedevents-u2l","depends_on_id":"voelgoedevents-c1q","type":"discovered-from","created_at":"2025-12-16T19:30:15.822285717+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-0xu","title":"Normalize actor shape to canonical 6-field actor across policies \u0026 calls","description":"Why:\nPhase 3 resources/policies must follow canonical actor shape (6 fields, user_id not id). Current codebase still uses actor(:id) and partial actors, which will cause inconsistent authorization and brittle tests.\n\nWhat:\n- Replace policy references actor(:id) -\u003e actor(:user_id)\n- Remove/replace partial/system actors with full 6-field actor map\n- Ensure actor is passed to final Ash create/update/read/destroy calls\n- Update fixtures/helpers/tests to build full actor consistently\n\nProof:\nmix format \u0026\u0026 mix compile \u0026\u0026 mix test","status":"in_progress","issue_type":"bug","created_at":"2025-12-16T10:11:33.232970186+02:00","updated_at":"2025-12-16T10:17:00.500055748+02:00","dependencies":[{"issue_id":"voelgoedevents-0xu","depends_on_id":"voelgoedevents-m4e","type":"discovered-from","created_at":"2025-12-16T10:12:29.619475585+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-0xu","depends_on_id":"voelgoedevents-c1q","type":"discovered-from","created_at":"2025-12-16T19:13:31.190867536+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-u28","title":"Phase 2 read-only audit vs canonical docs","notes":"Phase 2 read-only audit vs canonical docs (voelgoedevents-u28)\n\nStatus: NO-GO for Phase 3.\n\nBLOCKERS (linked issues):\n- voelgoedevents-wp2: Forbidden VoelgoedEvents* module prefixes present in lib/ (must be Voelgoedevents/VoelgoedeventsWeb only).\n- voelgoedevents-hco: DB roles table contains non-canonical roles (admin/manager/owner/read_only/staff/support) and is missing viewer/scanner_only; Role resource cannot load.\n- voelgoedevents-x3p + voelgoedevents-nrw: Role seeding/tests use non-existent Role.description and Ash 2.x APIs (Ash.create/4, Ash.destroy/3), causing Phase 2 tests to fail.\n- voelgoedevents-ysc: Non-canonical role atoms (:organizer, :scanner) used in resource policies.\n- voelgoedevents-c5u: OrganizationSettings policies use undefined fact/1 and lacks a primary read action; causes exceptions in tests and register_tenant flow.\n- voelgoedevents-050: Organization.register_tenant is public (authorize_if always) contrary to Phase 2 docs; also non-canonical actor usage in create_owner_and_membership.\n- voelgoedevents-o76: User resource RBAC is overly permissive + allows anonymous :read; actor key drift (:id vs :user_id).\n- voelgoedevents-8ox: Membership create/invite policies reference relationships -\u003e Ash CannotFilterCreates.\n- voelgoedevents-293 + voelgoedevents-5r8: Actor pipeline inconsistencies (CurrentOrgPlug reads Membership with actor nil; platform admin role nil fails ActorUtils) + Tenancy.Actor builds non-canonical actors.\n- voelgoedevents-5j9: AuditLog schema/policies drift from canonical audit docs; audit wiring likely broken.\n- voelgoedevents-rjo: Event.status atoms drift from domain spec (on_sale/paused/closed vs live/postponed/ended/cancelled/archived).\n- voelgoedevents-yln: Repo/ObanRepo migrations cross-contaminate schema_migrations -\u003e '** FILE NOT FOUND **' warnings.\n\nEvidence highlights:\n- mix ecto.migrations shows ** FILE NOT FOUND ** for 20251201103056 under Voelgoedevents.Repo and many missing under Voelgoedevents.ObanRepo.\n- psql roles query shows 6 rows: admin/manager/owner/read_only/staff/support.\n- mix test failures: rbac_sanity_test (Ash.create/4 undefined), membership_rbac_test (FilterByTenant requires org_id + CannotFilterCreates), accounts_test (fact/1 + missing primary read).","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-17T08:42:14.987572503+02:00","updated_at":"2025-12-17T09:26:10.181478817+02:00"}
{"id":"voelgoedevents-yey","title":"NoSuchFunction :actor still triggered during OrganizationSettings.create strict-check (macro expansion)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  OrganizationSettings.create fails strict-check with:\n    %Ash.Error.Query.NoSuchFunction{function: :actor}\n  even though OrganizationSettings policies no longer use ^actor pins and TenantPolicies has been cleaned.\n\nHypothesis:\n  Some policy macro expansion (e.g. PlatformPolicy.platform_admin_root_access/0 or similar) is injecting invalid actor() usage into expr/strict-check.\n\nNext steps:\n  Identify the exact macro expansion and remove invalid pinned/non-expr actor usage without changing authorization semantics.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T08:36:43.537278311+02:00","updated_at":"2025-12-18T08:48:53.98928015+02:00","closed_at":"2025-12-18T08:48:53.989282803+02:00","dependencies":[{"issue_id":"voelgoedevents-yey","depends_on_id":"voelgoedevents-6i0","type":"discovered-from","created_at":"2025-12-18T08:37:00.831209818+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-yey","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T08:37:11.059820086+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-7gi","title":"Missing CANONICAL_ATOMS_PHASE2.md (referenced by Phase 2 audit)","description":"Phase 2 audit (voelgoedevents-u28): audit checklist references CANONICAL_ATOMS_PHASE2.md but file is not present in repo. Either add the doc or update canonical references to point to existing atom sources (/docs/ash/ASH_3_RBAC_MATRIX.md and /docs/ai/ai_context_map.md).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T08:58:11.936845384+02:00","updated_at":"2025-12-17T08:58:11.936845384+02:00","dependencies":[{"issue_id":"voelgoedevents-7gi","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:58:18.711635469+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-lu6","title":"OrganizationSettings.create policy uses record filter (CannotFilterCreates)","description":"After removing invalid `fact(...)` usage from OrganizationSettings policies, full accounts tests fail with:\n\n- `Ash.Error.Forbidden.CannotFilterCreates` for `Voelgoedevents.Ash.Resources.Organizations.OrganizationSettings.create`\n\nRepro:\n- `mix test test/voelgoedevents/ash/accounts_test.exs`\n\nCause:\n- Policy for `action_type([:create, :update])` authorizes with an expression that references a record field (`organization_id == ^actor(:organization_id)`), which Ash 3 cannot evaluate for creates.\n\nFix direction:\n- Split create vs update/read policies.\n- For create, authorize using arguments (e.g. `^arg(:organization_id)`) or use `changing_attributes(...)`/custom checks per Ash guidance.\n- Do not change tests in that TOON.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-17T18:39:02.941150626+02:00","updated_at":"2025-12-17T20:02:00.730133024+02:00","dependencies":[{"issue_id":"voelgoedevents-lu6","depends_on_id":"voelgoedevents-050","type":"discovered-from","created_at":"2025-12-17T18:39:47.372918636+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-nrw","title":"Phase 2 tests use Ash 2.x API + Role.description (tests failing)","description":"Phase 2 audit (voelgoedevents-u28): mix test failures show tests still call Ash.create/4, Ash.destroy/3 and seed Role with %{name, description}. Ash 3.10 API requires Ash.create/3 (or changeset pipeline) and Role resource has :display_name/:permissions (no :description). Update tests to Ash 3 strict rules and canonical RBAC role schema.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:21:20.711024099+02:00","updated_at":"2025-12-17T09:21:20.711024099+02:00","dependencies":[{"issue_id":"voelgoedevents-nrw","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:21:30.371455289+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-o7o","title":"Organization.update(settings: ...) still crashes FilterByTenant (missing org_id context)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  RuntimeError: FilterByTenant requires actor or context with organization_id\n  during Organization.update when managing/loading :settings.\n\nExpected:\n  Organization.update(settings: ...) should ensure tenant scope (actor.organization_id or context.organization_id or source_context.organization_id) for tenant-filtered reads.\n\nNotes:\n  set_org_context_from_record/2 exists but org_id is still missing in the context used for relationship load in this path.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-18T10:43:59.758919805+02:00","updated_at":"2025-12-18T16:50:56.745424398+02:00","dependencies":[{"issue_id":"voelgoedevents-o7o","depends_on_id":"voelgoedevents-66e","type":"discovered-from","created_at":"2025-12-18T10:44:19.219471288+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-o7o","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T10:44:29.466366607+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-m4e","title":"Phase 3 start: normalize actor shape + implement Venue (with migration + tests)","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-16T10:10:21.594397099+02:00","updated_at":"2025-12-16T10:11:24.080672156+02:00","dependencies":[{"issue_id":"voelgoedevents-m4e","depends_on_id":"voelgoedevents-c1q","type":"discovered-from","created_at":"2025-12-16T19:13:31.23834465+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-hj6","title":"TenantPolicies: pinned ^actor(...) in expr causes NoSuchFunction :actor strict-check","description":"Problem:\n  Shared policy helper `lib/voelgoedevents/ash/policies/tenant_policies.ex` uses pinned `^actor(...)` inside `expr(...)`, which can explode during strict-check as:\n    %Ash.Error.Query.NoSuchFunction{function: :actor}\n  This poisons strict-check across resources that use the helper.\n\nFix:\n  Mechanical: replace `^actor(:field)` with `actor(:field)` inside `expr(...)` while keeping semantics identical.\n\nRepro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T08:10:14.929158831+02:00","updated_at":"2025-12-18T08:13:37.791745802+02:00","closed_at":"2025-12-18T08:13:37.791748436+02:00","dependencies":[{"issue_id":"voelgoedevents-hj6","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T08:11:15.907850245+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-050","title":"Organization resource creation/auth flow drift (register_tenant + policies)","description":"Update (2025-12-17):\n\nIMPORTANT: In Ash 3 policy expressions, we must use the pinned form ^actor(:field) inside expr(...).\nChanging policies from ^actor(:...) -\u003e actor(:...) caused strict-check failures:\n  Ash.Error.Query.NoSuchFunction (function :actor) during policy strict evaluation.\n\nRule:\n- Use expr(is_nil(^actor(:user_id))) not expr(is_nil(actor(:user_id)))\n- Use expr(^actor(:is_platform_admin) == true) not expr(actor(:is_platform_admin) == true)\n- Apply consistently across ALL Organization policies.\n\nNext steps to make tests pass:\n- Revert Organization policy expressions to ^actor(:...) everywhere (create/update/read/archive/register_tenant).\n- Fix Organization.create_owner_and_membership/3: User.create requires organization_id + role_id and uses password validations; authorize?: false does NOT bypass required inputs/validation.\n\nEvidence:\n- mix test test/voelgoedevents/ash/accounts_test.exs --only register_tenant fails with NoSuchFunction actor when using actor(:...).","notes":"- Locked down `Organization.register_tenant` to platform-admin only.\n  - Policy now: `forbid_if expr(is_nil(actor(:user_id)))` + `authorize_if expr(actor(:is_platform_admin) == true)`.\n  - File: `lib/voelgoedevents/ash/resources/accounts/organization.ex:151`.\n\n- Added explicit coverage for the security boundary.\n  - Anonymous denied: `test/voelgoedevents/ash/accounts_test.exs:372`.\n  - Logged-in non-platform-admin denied (non-nil `user_id`): `test/voelgoedevents/ash/accounts_test.exs:386`.\n  - Platform-admin allowed: `test/voelgoedevents/ash/accounts_test.exs:408`.\n  - Updated existing register_tenant tests to pass a platform-admin actor.\n\n- Manual verification:\n  - Run `mix test test/voelgoedevents/ash/accounts_test.exs` (not executed here per instruction).","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:56:59.505311221+02:00","updated_at":"2025-12-17T18:36:05.821489063+02:00","dependencies":[{"issue_id":"voelgoedevents-050","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:57:21.220784636+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-050","depends_on_id":"voelgoedevents-6in","type":"parent-child","created_at":"2025-12-17T12:24:13.483193653+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-050","depends_on_id":"voelgoedevents-kyn","type":"blocks","created_at":"2025-12-17T12:57:49.017104584+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-050","depends_on_id":"voelgoedevents-6in","type":"blocks","created_at":"2025-12-17T12:21:03.593281626+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-b8h","title":"accounts_test Organization.load(:settings) fails FilterByTenant when actor lacks organization_id","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  RuntimeError: FilterByTenant requires actor or context with organization_id\n  when running:\n    loaded = Ash.load!(organization, :settings, actor: actor)\n  Stack shows failure inside Organization.read preparation FilterByTenant.\n\nExpected:\n  Tests (and any request flow) pass tenant context for tenant-filtered reads.\n\nNotes:\n  Actor passed to Ash.load!/3 appears to be missing organization_id (e.g. platform admin actor) or context isn't set.\n  Fix should be scoped to the failing test helper/actor or load call (no tenant isolation weakening).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T20:43:32.083735906+02:00","updated_at":"2025-12-18T07:59:11.950424042+02:00","closed_at":"2025-12-18T07:59:11.950425942+02:00","dependencies":[{"issue_id":"voelgoedevents-b8h","depends_on_id":"voelgoedevents-5dj","type":"discovered-from","created_at":"2025-12-17T20:43:48.795630218+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-b8h","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T20:45:37.235984668+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-pjd","title":"accounts_test unauthenticated actor settings create expects ok but hits unique constraint","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  In \"unauthenticated actor cannot read or write organization settings\" (accounts_test.exs:250), the test pattern-matches:\n    {:ok, settings} = OrganizationSettings.create(...)\n  but gets:\n    {:error, %Ash.Error.Invalid{... field: :organization_id, message: \"has already been taken\"}}\n  constraint: organization_settings_organization_id_index\n\nLikely cause:\n  Organization settings already exist for the org at this point (auto-created during Organization.create or earlier setup), so attempting to create settings again is a duplicate.\n\nExpected:\n  Test should not assume a second create succeeds (or flow should update existing settings).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T08:49:18.853077167+02:00","updated_at":"2025-12-18T08:59:52.147964513+02:00","closed_at":"2025-12-18T08:59:52.147966746+02:00","dependencies":[{"issue_id":"voelgoedevents-pjd","depends_on_id":"voelgoedevents-yey","type":"discovered-from","created_at":"2025-12-18T08:49:40.742467581+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-pjd","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T08:49:50.945132279+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-yln","title":"Ecto migrations misconfigured across Repo/ObanRepo (schema_migrations contains other repo ids)","description":"Phase 2 audit (voelgoedevents-u28): mix ecto.migrations shows '** FILE NOT FOUND **' because Voelgoedevents.Repo and Voelgoedevents.ObanRepo share the same schema_migrations table but use different migrations paths (priv/repo/migrations vs priv/oban_repo/migrations). Configure distinct migration_source per repo or consolidate repos to avoid cross-contamination.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T09:21:58.642502644+02:00","updated_at":"2025-12-17T09:21:58.642502644+02:00","dependencies":[{"issue_id":"voelgoedevents-yln","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:22:28.112590051+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-cti","title":"Silence Inspect protocol consolidation warnings in audit_change_test","description":"Completed (2025-12-16):\n- Implemented Option 2: fully qualified domain module references (Voelgoedevents.Ash.Changes.AuditChangeTest.TestDomain) to avoid Spark DSL module errors.\n- audit_change_test.exs now passes domain module explicitly where used.\n\nVerification:\n- mix test test/voelgoedevents/ash/changes/audit_change_test.exs --seed 0\n  Result: 2 tests, 0 failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T21:03:04.556375622+02:00","updated_at":"2025-12-16T22:16:35.057340712+02:00","closed_at":"2025-12-16T22:16:35.057340712+02:00"}
{"id":"voelgoedevents-6in","title":"register_tenant: Organization creates User with wrong credential field (hashed_password required)","description":"After fixing duplicate memberships (voelgoedevents-n4j), register_tenant tests still fail.\nCurrent failure: User.create requires :hashed_password, but Organization.create_owner_and_membership/3 passes :password.\n\nFix: Align Organization.create_owner_and_membership/3 with User.create contract.\n- If User.create expects hashed_password, pass hashed_password and remove password.\n- Keep org_id/role_id passed (needed for setup_new_user_membership/2).\nKPI: mix test test/voelgoedevents/ash/accounts_test.exs --only register_tenant removes hashed_password failure.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T12:18:19.593521096+02:00","updated_at":"2025-12-17T12:52:15.168216773+02:00","closed_at":"2025-12-17T12:52:15.168216773+02:00"}
{"id":"voelgoedevents-5j9","title":"AuditLog resource schema/policy drift vs canonical audit docs","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents/ash/resources/audit/audit_log.ex fields/policies differ from /docs/phases_and_roadmap/PHASE_02_Tenancy_Accounts_\u0026_RBAC.md and /docs/domain/audit_logging.md (e.g., missing actor_type/origin, organization_id allow_nil? true, read policy not role-gated, create policy missing/authorize? handling). Align resource + migration + auditable extension wiring.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:57:32.421770421+02:00","updated_at":"2025-12-17T08:57:32.421770421+02:00","dependencies":[{"issue_id":"voelgoedevents-5j9","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:57:40.895270383+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-g05","title":"FilterByTenant tests: match Ash 3 predicate shape (Eq left/right)","description":"Done:\n- Updated FilterByTenant tests to assert Ash 3 Eq predicate semantics using org_id_ref?/1 helper (supports atom and Ash.Query.Ref forms).\nProof:\n- mix test test/voelgoedevents/ash/preparations/filter_by_tenant_test.exs --seed 0 (PASS)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T19:15:59.019199721+02:00","updated_at":"2025-12-16T19:29:30.554977012+02:00","closed_at":"2025-12-16T19:29:30.554977012+02:00","dependencies":[{"issue_id":"voelgoedevents-g05","depends_on_id":"voelgoedevents-c1q","type":"discovered-from","created_at":"2025-12-16T19:17:23.436605332+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-rjo","title":"Event.status atoms drift from domain spec (on_sale/paused/closed vs live/postponed/ended/cancelled)","description":"Phase 2 audit (voelgoedevents-u28): docs/domain/events_venues.md defines Event.status states (draft/published/live/postponed/ended/cancelled/archived) and explicitly says 'on sale' is derived, not a status. Code in lib/voelgoedevents/ash/resources/events/event.ex constrains status to [:draft,:published,:on_sale,:paused,:closed]. Needs alignment.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T09:05:37.021762866+02:00","updated_at":"2025-12-17T09:05:37.021762866+02:00","dependencies":[{"issue_id":"voelgoedevents-rjo","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:05:44.99762734+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-eje","title":"accounts_test roles create expects ok but roles already exist (unique roles_name_index)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  Test \"roles expose canonical display name and permissions\" pattern-matches {:ok, role} from Role.create, but gets:\n    {:error, %Ash.Error.Invalid{errors: [%Ash.Error.Changes.InvalidAttribute{field: :name, message: \"has already been taken\", constraint: \"roles_name_index\", detail: \"Key (name)=(admin) already exists.\"}]}}\n\nExpected:\n  Test should not assume Role.create succeeds if canonical roles are pre-seeded or created elsewhere; it should read existing role or ensure clean setup.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:25:50.852226673+02:00","updated_at":"2025-12-18T09:33:21.611753268+02:00","closed_at":"2025-12-18T09:33:21.611755165+02:00","dependencies":[{"issue_id":"voelgoedevents-eje","depends_on_id":"voelgoedevents-4ds","type":"discovered-from","created_at":"2025-12-18T09:26:11.374564747+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-eje","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T09:26:19.705613382+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-9qg","title":"OrganizationSettings duplicate create returns Ecto.ConstraintError instead of Ash.Invalid","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  OrganizationSettings.create (second create for same org) raises:\n    Ecto.ConstraintError (organization_settings_organization_id_index)\n  which is wrapped as Ash.Error.Unknown.\n\nExpected:\n  Ash.Error.Invalid (identity/constraint mapped).\n\nRoot cause:\n  Ash identity is missing or not mapped to the firing DB unique index.\n\nFix:\n  Align Ash identity \u0015 Postgres unique index (or remove redundant unique index).","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-17T20:25:02.099919805+02:00","updated_at":"2025-12-17T20:25:49.277998361+02:00","dependencies":[{"issue_id":"voelgoedevents-9qg","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T20:25:59.468774674+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-9qg","depends_on_id":"voelgoedevents-hj6","type":"blocks","created_at":"2025-12-18T08:11:24.51142509+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-33g","title":"Fix auth login rate limit regression tests","description":"Progress (2025-12-16):\n- audit_change.ex: actor extraction is now KeyError-safe (no dot-access) and supports map/keyword contexts/private contexts via fetch/2 helper.\n- audit_change.ex: audit params are filtered by accepted inputs for the audit_resource :create action, supporting both atom and string keys.\n- audit_change_test.exs: updated failure assertion to expect Ash.Error.Unknown (Ash 3 wraps errors) while still asserting message contains \"Audit logging failed\".\n\nVerification:\n- mix test test/voelgoedevents/ash/changes/audit_change_test.exs --seed 0\n  Result: 2 tests, 0 failures.\n\nNotes:\n- Only warnings remain (unused aliases, domain inclusion warning in test domain).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T07:38:53.475697877+02:00","updated_at":"2025-12-16T20:30:24.725420262+02:00","closed_at":"2025-12-16T20:30:24.725420262+02:00"}
{"id":"voelgoedevents-5r8","title":"Tenancy.Actor helpers build non-canonical actors (:system_worker, missing fields)","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents/tenancy/actor.ex constructs actors that do not match canonical 6-field shape (user_id/organization_id/role/is_platform_admin/is_platform_staff/type) and uses non-canonical role :system_worker. Domain docs reference these helpers; reconcile with Voelgoedevents.Ash.Support.ActorUtils.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T09:15:26.927623814+02:00","updated_at":"2025-12-17T09:15:26.927623814+02:00","dependencies":[{"issue_id":"voelgoedevents-5r8","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:15:36.362157066+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-5dj","title":"OrganizationSettings.create policy strict-check fails with NoSuchFunction :actor","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  OrganizationSettings.create fails during policy strict-check with:\n    %Ash.Error.Query.NoSuchFunction{function: :actor}\n\nLikely cause:\n  OrganizationSettings policies use actor(...) in expr without the pinned form expected by this codebase (other policies use ^actor(...)).\n\nFix intent:\n  Make OrganizationSettings create policy expression valid (no NoSuchFunction), without changing authorization semantics.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T20:32:46.059835752+02:00","updated_at":"2025-12-17T20:42:28.208816574+02:00","closed_at":"2025-12-17T20:42:28.208818565+02:00","dependencies":[{"issue_id":"voelgoedevents-5dj","depends_on_id":"voelgoedevents-9qg","type":"discovered-from","created_at":"2025-12-17T20:33:21.650365768+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-4ds","title":"OrganizationSettings.create policy uses record filter on create (CannotFilterCreates)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  OrganizationSettings.create fails with Ash.Error.Forbidden.CannotFilterCreates.\n  Filter shown in error: organization_id == \u003corg_id\u003e (record attribute filter).\n\nCause:\n  Create policy contains a filter expression referencing record attributes (organization_id) which Ash cannot evaluate for creates.\n\nExpected:\n  Create policy must be create-safe (actor/context only, or changing_attributes-based checks / custom check) so it returns Forbidden/Invalid, not crash.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:00:13.521137288+02:00","updated_at":"2025-12-18T09:25:31.959152696+02:00","closed_at":"2025-12-18T09:25:31.959155342+02:00","dependencies":[{"issue_id":"voelgoedevents-4ds","depends_on_id":"voelgoedevents-pjd","type":"discovered-from","created_at":"2025-12-18T09:00:33.508479707+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-4ds","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T09:00:43.709735802+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-4ds","depends_on_id":"voelgoedevents-20t","type":"discovered-from","created_at":"2025-12-18T09:19:30.492525413+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-wp2","title":"Fix forbidden VoelgoedEvents* module prefixes in lib","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:55:58.621716509+02:00","updated_at":"2025-12-17T08:55:58.621716509+02:00","dependencies":[{"issue_id":"voelgoedevents-wp2","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:56:13.600622892+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-kyn","title":"User.create after_action arity mismatch in audit_platform_admin_change (BadArityError)","description":"When `Organization.register_tenant` creates an owner user (via `User.create`), the create succeeds but then crashes with:\n\n- `BadArityError` in `Voelgoedevents.Ash.Resources.Accounts.User.audit_platform_admin_change/2` after_action callback\n- Message: function arity 3 called with 2 args (`(#Ash.Changeset\u003c...\u003e, %User{...})`)\n\nRepro:\n- `mix test test/voelgoedevents/ash/accounts_test.exs --only register_tenant`\n\nLikely cause:\n- `lib/voelgoedevents/ash/resources/accounts/user.ex` defines `audit_platform_admin_change/2` which calls `Ash.Changeset.after_action(changeset, fn changeset, user, context -\u003e ... end)` (arity 3), but Ash is invoking the callback with 2 args.\n\nFix direction:\n- Align `Ash.Changeset.after_action/2` callback arity with what Ash expects (likely arity 2), while keeping audit logging behavior correct.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T12:54:17.216005098+02:00","updated_at":"2025-12-17T13:08:15.440018324+02:00","closed_at":"2025-12-17T13:08:15.440018324+02:00","dependencies":[{"issue_id":"voelgoedevents-kyn","depends_on_id":"voelgoedevents-6in","type":"discovered-from","created_at":"2025-12-17T12:56:56.026511696+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-293","title":"Actor pipeline bugs: CurrentOrgPlug membership lookup uses actor nil; platform admin role nil breaks ActorUtils","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents_web/plugs/current_org_plug.ex calls Ash.read_one on Membership with actor: nil (conflicts with FilterByTenant and Membership policies) and sets role=nil for platform admins; lib/voelgoedevents_web/plugs/set_ash_actor_plug.ex then passes role nil into ActorUtils.normalize/1 which rejects non-canonical role. Actor pipeline likely fails for both regular users and platform admins.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:20:44.975895724+02:00","updated_at":"2025-12-17T19:45:49.195807599+02:00","closed_at":"2025-12-17T19:45:49.195811323+02:00","dependencies":[{"issue_id":"voelgoedevents-293","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:20:55.125631875+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-ysc","title":"Non-canonical role atoms (:organizer/:scanner) used in resource policies","description":"Phase 2 audit (voelgoedevents-u28): Found non-canonical role atoms in Ash policies: :organizer in lib/voelgoedevents/ash/resources/events/event.ex and :scanner in lib/voelgoedevents/ash/resources/scanning/scan_session.ex. Canonical tenant roles are exactly [:owner,:admin,:staff,:viewer,:scanner_only] per /docs/domain/rbac_and_platform_access.md and /docs/ash/ASH_3_RBAC_MATRIX.md.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:04:56.598523942+02:00","updated_at":"2025-12-17T09:04:56.598523942+02:00","dependencies":[{"issue_id":"voelgoedevents-ysc","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:05:03.779022737+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-otr","title":"User resource missing primary read action breaks relationship loads (Ash.load memberships: :user)","description":"Register_tenant tests now fail when loading memberships.user.\n\nError:\n- RuntimeError: Required primary read action for Voelgoedevents.Ash.Resources.Accounts.User.\n\nRepro:\n- mix test test/voelgoedevents/ash/accounts_test.exs --only register_tenant\n\nWhere it blows up:\n- Ash.load!(org, [memberships: :user], actor: tenant_actor(org.id, :owner), authorize?: false)\n\nLikely fix:\n- Define a primary read action on User (or mark an existing read action as primary) so relationship loads can resolve a read action.\nFile: lib/voelgoedevents/ash/resources/accounts/user.ex\n\nNotes:\n- This was discovered while working on voelgoedevents-050 (TOON-1). The register_tenant policy is already locked down to platform-admin; remaining failures are now about this missing primary read action.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T17:10:21.799047981+02:00","updated_at":"2025-12-17T17:35:51.129811547+02:00","closed_at":"2025-12-17T17:35:51.129811547+02:00","dependencies":[{"issue_id":"voelgoedevents-otr","depends_on_id":"voelgoedevents-050","type":"discovered-from","created_at":"2025-12-17T17:13:15.448880976+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-uij","title":"Phase 3.1.1 Venue: migration + resource + policies + tests","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-16T10:11:33.281014137+02:00","updated_at":"2025-12-16T10:11:33.281014137+02:00","dependencies":[{"issue_id":"voelgoedevents-uij","depends_on_id":"voelgoedevents-m4e","type":"discovered-from","created_at":"2025-12-16T10:12:29.665074954+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-uij","depends_on_id":"voelgoedevents-c1q","type":"discovered-from","created_at":"2025-12-16T19:13:31.282905596+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-ckh","title":"Organization.update settings load missing tenant context for platform actor (FilterByTenant crash)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nFailure:\n  RuntimeError: FilterByTenant requires actor or context with organization_id\n  raised during Organization.update manage_relationship/load(:settings).\n\nExpected:\n  Platform admin can update an Organization and its settings without crashing, while still keeping tenant isolation intact.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:09:21.971768625+02:00","updated_at":"2025-12-18T09:11:32.632799721+02:00","closed_at":"2025-12-18T09:11:32.632801765+02:00","dependencies":[{"issue_id":"voelgoedevents-ckh","depends_on_id":"voelgoedevents-pjd","type":"discovered-from","created_at":"2025-12-18T09:09:40.556509373+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-3d6","title":"OrganizationSettings one-to-one test expects duplicate Invalid but create succeeds (settings no longer auto-created)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  Test \"organization settings enforces one-to-one settings per organization\" expects:\n    {:error, %Ash.Error.Invalid{...}} = OrganizationSettings.create(...)\n  but now gets {:ok, %OrganizationSettings{...}}.\n\nLikely cause:\n  After changing Organization.create to stop auto-creating settings when :settings arg is absent, the org no longer has settings, so the first explicit create succeeds.\n\nExpected:\n  Test should create settings twice (or ensure settings exist) to assert one-to-one uniqueness.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:33:54.004890956+02:00","updated_at":"2025-12-18T09:45:30.956683086+02:00","closed_at":"2025-12-18T09:45:30.956685111+02:00","dependencies":[{"issue_id":"voelgoedevents-3d6","depends_on_id":"voelgoedevents-eje","type":"discovered-from","created_at":"2025-12-18T09:34:25.85442246+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-3d6","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T09:34:36.089868769+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-lq8","title":"Silence warnings in audit_change_test.exs (unused alias + TestDomain inclusion)","description":"Completed (2025-12-16):\n- Removed unused alias AuditChange in audit_change_test.exs.\n- Updated TestDomain to use Ash.Domain with validate_config_inclusion?: false to silence domain inclusion warning.\n\nVerification:\n- mix test test/voelgoedevents/ash/changes/audit_change_test.exs --seed 0\n  Result: 2 tests, 0 failures.\n\nNotes:\n- Remaining warnings are protocol consolidation warnings (Inspect) for test-defined modules; separate concern.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T20:36:41.001609632+02:00","updated_at":"2025-12-16T21:00:28.395661909+02:00","closed_at":"2025-12-16T21:00:28.395661909+02:00"}
{"id":"voelgoedevents-mph","title":"TenantPolicies module contains forbidden patterns / DB reads","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents/ash/policies/tenant_policies.ex appears unused but contains Ash.read_one calls without actor, potential DB hits inside policy helpers, and non-canonical actor key usage (:id vs :user_id, ^actor(...) in expr). Decide: delete, rewrite to Ash 3 policy templates, or isolate as legacy with docs.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T08:57:47.881098794+02:00","updated_at":"2025-12-17T08:57:47.881098794+02:00","dependencies":[{"issue_id":"voelgoedevents-mph","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T08:58:00.908625358+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-fg9","title":"Organization settings update via Organization.update triggers FilterByTenant missing org_id","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nFailure:\n  RuntimeError: FilterByTenant requires actor or context with organization_id\n  Bread crumbs show Organization.read and Organization.update; stack includes managed relationship loading.\n\nExpected:\n  Updating organization settings through Organization.update should provide tenant scope (actor.organization_id or context.organization_id) for the tenant-filtered relationship reads.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:45:54.842887558+02:00","updated_at":"2025-12-18T10:18:37.350995555+02:00","closed_at":"2025-12-18T10:18:37.350997759+02:00","dependencies":[{"issue_id":"voelgoedevents-fg9","depends_on_id":"voelgoedevents-3d6","type":"discovered-from","created_at":"2025-12-18T09:46:19.649744489+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-20t","title":"Role.create unique constraint raises Ash.Error.Unknown instead of Ash.Error.Invalid","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  Role.create fails with Ecto.ConstraintError on roles_name_index, wrapped as Ash.Error.Unknown.\n\nExpected:\n  Unique violation should map to Ash.Error.Invalid via identity/index mapping.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T09:12:14.74501965+02:00","updated_at":"2025-12-18T09:19:20.242758655+02:00","closed_at":"2025-12-18T09:19:20.242764966+02:00","dependencies":[{"issue_id":"voelgoedevents-20t","depends_on_id":"voelgoedevents-ckh","type":"discovered-from","created_at":"2025-12-18T09:12:44.623141092+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-6i0","title":"OrganizationSettings missing primary update action breaks Organization.update(settings: ...)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  RuntimeError: Required primary update action for Voelgoedevents.Ash.Resources.Organizations.OrganizationSettings\n  occurs during Organization.update when managing the :settings relationship.\n\nLikely cause:\n  OrganizationSettings has an update action but it is not marked primary? true, and Ash managed_relationship needs a primary update action for the related resource.\n\nExpected:\n  Relationship management can resolve an update action for OrganizationSettings without crashing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T08:14:33.867523291+02:00","updated_at":"2025-12-18T08:36:21.552866135+02:00","closed_at":"2025-12-18T08:36:21.552868395+02:00","dependencies":[{"issue_id":"voelgoedevents-6i0","depends_on_id":"voelgoedevents-hj6","type":"discovered-from","created_at":"2025-12-18T08:14:59.883369523+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-6i0","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T08:15:08.379553612+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-c1q","title":"Phase 3 Readiness Gate: Ash 3.x Tenant + Policies + Audit Stabilization","description":"Closed voelgoedevents-g05: FilterByTenant tests now assert Ash 3 predicate semantics (org_id_ref?/1).","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-16T19:12:27.020809145+02:00","updated_at":"2025-12-16T19:29:30.604046495+02:00"}
{"id":"voelgoedevents-c5u","title":"OrganizationSettings policies use undefined fact/1 (likely broken authorization)","description":"Phase 2 audit (voelgoedevents-u28): lib/voelgoedevents/ash/resources/organizations/organization_settings.ex uses fact(:actor_user_id)/fact(:actor_org_id)/fact(:actor_role) in policies but no facts are defined (CommonPolicies empty). Verify if this compiles/works; likely needs conversion to canonical actor(:user_id)/actor(:organization_id)/actor(:role) policy templates.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-17T09:03:44.709575832+02:00","updated_at":"2025-12-17T09:03:44.709575832+02:00","dependencies":[{"issue_id":"voelgoedevents-c5u","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:03:52.287201115+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-hco","title":"DB roles table contains non-canonical role 'support' causing Role.read load errors","description":"Phase 2 audit (voelgoedevents-u28): Ash.read(Role, authorize?: false) fails because roles.name contains value \"support\" which is not in Role.allowed_roles ([:owner,:admin,:staff,:viewer,:scanner_only]). Must migrate/clean DB (delete/rename row) or adjust resource per canonical docs.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:13:17.46025985+02:00","updated_at":"2025-12-17T09:13:17.46025985+02:00","dependencies":[{"issue_id":"voelgoedevents-hco","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:13:27.796794666+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-iur","title":"accounts_test: platform admin creating OrganizationSettings hits unique constraint (settings already exist)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  Test \"platform admin can create settings for any organization\" expects {:ok, settings} but gets:\n    {:error, %Ash.Error.Invalid{errors: [%Ash.Error.Changes.InvalidAttribute{field: :organization_id, message: \"has already been taken\", ...}]}}\n  constraint: organization_settings_organization_id_index\n\nLikely cause:\n  Organization settings already exist for newly created orgs (auto-created via Organization.create or similar), so an additional OrganizationSettings.create is a duplicate.\n\nExpected:\n  Either the test should update existing settings (or org creation should not auto-create settings) but that is a separate decision.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-18T07:59:35.503259108+02:00","updated_at":"2025-12-18T07:59:35.503259108+02:00","dependencies":[{"issue_id":"voelgoedevents-iur","depends_on_id":"voelgoedevents-b8h","type":"discovered-from","created_at":"2025-12-18T07:59:54.811977046+02:00","created_by":"jcs"}]}
{"id":"voelgoedevents-a08","title":"register_tenant test uses membership.user.email.value but email is Ash.CiString","description":"After fixing Accounts.User primary read action (voelgoedevents-otr),  now fails with:  at  where it asserts . Fix should adjust the assertion to use the correct Ash.CiString access (e.g.,  or ) without changing non-register_tenant tests.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T17:32:29.255905681+02:00","updated_at":"2025-12-17T17:57:21.201870573+02:00","closed_at":"2025-12-17T17:57:21.201870573+02:00","dependencies":[{"issue_id":"voelgoedevents-a08","depends_on_id":"voelgoedevents-otr","type":"discovered-from","created_at":"2025-12-17T17:33:42.068075746+02:00","created_by":"jcs"},{"issue_id":"voelgoedevents-a08","depends_on_id":"voelgoedevents-050","type":"blocks","created_at":"2025-12-17T17:36:44.970659396+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-66e","title":"Role canonical permissions not applied (existing role has empty permissions)","description":"Repro:\n  mix test test/voelgoedevents/ash/accounts_test.exs --max-failures 1\n\nObserved:\n  In roles test, reading/using an existing :admin role returns permissions == [] but canonical permissions are expected.\n\nExpected:\n  Canonical roles should always have their canonical display_name/permissions applied (seed or create/update change), or the test should load a role that has canonical metadata applied.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-18T10:11:37.545097786+02:00","updated_at":"2025-12-18T14:22:21.784342844+02:00","closed_at":"2025-12-18T10:43:35.024434248+02:00","dependencies":[{"issue_id":"voelgoedevents-66e","depends_on_id":"voelgoedevents-fg9","type":"discovered-from","created_at":"2025-12-18T10:25:08.024540811+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-66e","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-18T10:25:08.071640489+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-8ox","title":"Membership create/invite policies use relationship filters (CannotFilterCreates)","description":"Phase 2 audit (voelgoedevents-u28): mix test membership_rbac_test shows Ash.Error.Forbidden.CannotFilterCreates for Voelgoedevents.Ash.Resources.Accounts.Membership.invite because policies reference relationship fields (user.is_platform_staff) in create actions. Ash 3 policy authorizer cannot filter creates; requires custom check or separate create-specific policies.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:18:14.775374046+02:00","updated_at":"2025-12-17T09:18:14.775374046+02:00","dependencies":[{"issue_id":"voelgoedevents-8ox","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:18:29.674533064+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-yej","title":"Remove unused aliases in audit_change.ex","description":"Completed (2025-12-16):\n- Removed unused aliases AuditDomain and AuditLog from lib/voelgoedevents/ash/changes/audit_change.ex.\n\nVerification:\n- mix test test/voelgoedevents/ash/changes/audit_change_test.exs --seed 0\n  Result: 2 tests, 0 failures.\n  Note: Remaining warnings are in the test file (unused alias AuditChange, TestDomain config inclusion), not in audit_change.ex.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T20:32:45.671352146+02:00","updated_at":"2025-12-16T20:36:30.122438191+02:00","closed_at":"2025-12-16T20:36:30.122438191+02:00"}
{"id":"voelgoedevents-n4j","title":"register_tenant creates duplicate Membership because User.create already manages memberships","description":"Decision:\n- User.create owns membership creation.\n- Organization.register_tenant/create_owner_and_membership/3 must not create Membership explicitly.\n\nBug: Organization.create_owner_and_membership/3 creates Membership explicitly, but User.create already manage_relationship(:memberships) via setup_new_user_membership/2.\nResult: Two memberships for the owner, test expects exactly 1 membership.\n\nFix: Remove explicit Membership creation from Organization.create_owner_and_membership/3 OR refactor User.create to not manage membership.\nChosen path (minimal + matches current design): remove explicit Membership create and rely on User.create to create the membership.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T11:37:30.623021811+02:00","updated_at":"2025-12-17T12:07:21.043596763+02:00","dependencies":[{"issue_id":"voelgoedevents-n4j","depends_on_id":"voelgoedevents-050","type":"blocks","created_at":"2025-12-17T11:40:48.208762965+02:00","created_by":"daemon"},{"issue_id":"voelgoedevents-n4j","depends_on_id":"voelgoedevents-1af","type":"blocks","created_at":"2025-12-17T11:40:48.259311657+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-x3p","title":"priv/repo/seeds.exs Role seeding uses non-existent :description field","description":"Phase 2 audit (voelgoedevents-u28): priv/repo/seeds.exs seeds Role with %{name, description} but Voelgoedevents.Ash.Resources.Accounts.Role defines attributes :name, :display_name, :permissions (no :description). Seeding likely fails and canonical roles may be missing/incorrect.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-17T09:11:06.088537276+02:00","updated_at":"2025-12-17T09:11:06.088537276+02:00","dependencies":[{"issue_id":"voelgoedevents-x3p","depends_on_id":"voelgoedevents-u28","type":"discovered-from","created_at":"2025-12-17T09:11:20.423213762+02:00","created_by":"daemon"}]}
{"id":"voelgoedevents-1af","title":"Ash 3 policy expression rule: always use ^actor(:field) in expr/1","description":"Ash 3 strict-check will explode with NoSuchFunction actor if policies use actor(:field) inside expr/1. Standardize on ^actor(:field) everywhere.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T11:20:17.931069829+02:00","updated_at":"2025-12-17T11:20:17.931069829+02:00"}
